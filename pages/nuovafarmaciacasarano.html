<!DOCTYPE html>
<html class="full">
    <head>
        <title>boostrapped</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
              rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" 
              crossorigin="anonymous">
        <link href="http://www.di-vision.org/cdn/nuovafarmacia.css" rel="stylesheet">
        <style>
            #servizi {
                position: fixed;
                bottom: 0;
                right: 0;
                width: 75%;
                height: 15%;
                font-size: 9em;
                color: white;
                font-weight: bold;
                background-color: rgba(0,158,64,0.9);
                /*border: 1px solid #dd4814;*/
                padding: 53px;
                text-align: -6px -4px black;
            }
            #hubNumber {
                background-color: rgba(0,158,64,0.9);
            }
            .placeholder1 {
                width: 45%;
                height: auto;
                z-index: 2;
                position: absolute;
                top: 12%;
                right: 1%;
                color: white;
            }
            h1 {
                font-size: 9em;
                text-align: center;
                font: bolder;
                font-family: "Arial Black", Gadget, sans-serif;
                background-color: rgba(22,22,22,0.5);
                padding: 2%;
            }
            .rgba {
                border: 4px solid darkgreen;
                background-color: rgba(22,22,22,0.5);
            }
            .descrizione{
                font-size: 7em;
                font-family: cursive;
                padding: 2%;
            }
        </style>
    </head>
    <body>
        
        <script id="news-template" type="text/x-handlebars-template">
            <div id="placed-in" class="placeholder1">
            {{#sites}}
                {{#if titolo}}
                    <div class="{{#if @first}}classed{{else}}collapse{{/if}} all">
                        <h1 class="title rgba">{{titolo}}</h1>
                        <p class="descrizione rgba">{{{descrizione}}}</p>
                        <!--<img src="https://unsplash.it/300/300/?random" class="img"/>-->
                    </div>
                {{/if}}
            {{/sites}}
            </div>
        </script>
        
        
        <div id="content-placeholder" class=""></div>
        
        <div id="hubNumber"></div>

        <div id="mycarousel" class="carousel slide" data-ride="carousel">
            <!-- Indicators -->
<!--            <ol class="carousel-indicators">
                <li data-target="#mycarousel" data-slide-to="0" class=""></li>
                <li data-target="#mycarousel" data-slide-to="1"></li>

            </ol>-->
            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox">

                <div class="item">
                    <img src="https://s5.postimg.org/tdy2z31rb/alex-knight-204446.jpg" data-color="lightblue" alt="First Image">
                    <!--<div class="carousel-caption"><h3>First Image</h3></div>-->
                </div>

                <div class="item">
                    <img src="https://s5.postimg.org/5bluhyahz/andres-de-armas-103880.jpg" data-color="firebrick" alt="Second Image">
                    <!--<div class="carousel-caption"><h3>Second Image</h3></div>-->
                </div>

                <div class="item">
                    <img src="https://s5.postimg.org/her65ilk7/ciprian-boiciuc-66195.jpg" data-color="firebrick" alt="Second Image">
                    <!--<div class="carousel-caption"><h3>Second Image</h3></div>-->
                </div>

                <div class="item">
                    <img src="https://s5.postimg.org/ow0dkqb3b/elizabeth-misner-207528.jpg" data-color="firebrick" alt="Second Image">
                    <!--<div class="carousel-caption"><h3>Second Image</h3></div>-->
                </div>

                <div class="item">
                    <img src="https://s5.postimg.org/ahwzszp9j/jesse-orrico-60373.jpg" data-color="firebrick" alt="Second Image">
                    <!--<div class="carousel-caption"><h3>Second Image</h3></div>-->
                </div>

                <div class="item">
                    <img src="https://s5.postimg.org/5hzjl1jmv/freestocks-org-126848.jpg" data-color="firebrick" alt="Second Image">
                    <!--<div class="carousel-caption"><h3>Second Image</h3></div>-->
                </div>

                <div class="item">
                    <img src="https://s5.postimg.org/41o12wgpz/forest-alu-247542.jpg" data-color="firebrick" alt="Second Image">
                    <!--<div class="carousel-caption"><h3>Second Image</h3></div>-->
                </div>

                <div class="item">
                    <img src="https://s5.postimg.org/fcqor9nl3/elly-filho-65831.jpg" data-color="firebrick" alt="Second Image">
                    <!--<div class="carousel-caption"><h3>Second Image</h3></div>-->
                </div>

            </div> <!--end wrapper items gallery-->

            <!-- Controls -->
            <a class="left carousel-control" href="#mycarousel" role="button" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#mycarousel" role="button" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>

        </div> <!-- end mycarousel-->
        
        <div id="servizi"></div>
        
        <div id="news-template" class="news-template"></div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js" 
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" 
        crossorigin="anonymous">

</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" 
        crossorigin="anonymous">

</script>
<script src="/socket.io/socket.io.js"></script>
<script src="/varSocketURI.js"></script>
<!-- GET SCRIPT FOR AUDIO
    <script src="../client/js/audio.js"></script>
-->
<script>
    var $item = $('.carousel .item');
    var $wHeight = $(window).height();
    $item.eq(0).addClass('active');
    $item.height($wHeight);
    $item.addClass('full-screen');

    $('.carousel img').each(function () {
        var $src = $(this).attr('src');
        var $color = $(this).attr('data-color');
        $(this).parent().css({
            'background-image': 'url(' + $src + ')',
            'background-color': $color
        });
        $(this).remove();
    });

    $(window).on('resize', function () {
        $wHeight = $(window).height();
        $item.height($wHeight);
    });

    $('.carousel').carousel({
        interval: 11 * 1000,
        keyboard: true,
        pause: "false"
    });
//            gestione click da tastiera
    $(document).bind('keydown', function (e) {
        if (e.which == 39) {
            $('.carousel').carousel('next');
        } else if (e.which == 37) {
            $('.carousel').carousel('prev');
        }
    });
</script>
        
<script>
    var servizi = [
        "DERMOCOSMESI",
        "IGIENE E CURA PERSONA",
        "PRIMA INFANZIA",
        "ALIMENTAZIONE SPECIALE",
        "OMEOPATIA",
        "FITOTERAPIA",
        "INTEGRATORI",
        "SANITARIA",
        "ELETTROCARDIOGRAMMA",
        "HOLTER PRESSORIO E CARDIACO",
        "PRENOTAZIONE CUP",
        "MISURAZIONE PRESSIONE"
    ];
    
    function jsonCallback(data) {
            $.each(data.sites, function (key, val) {});
        };
    $(document).ready(function () {
        returnData = '';
        that = this;
        urlJson = 'http://www.di-vision.org/getNews.php?userID='+ch+'&content_type=my_news&callback=?';
        /* code to get params form url in html page */
        var QueryString = function () {
            /* This function is anonymous, is executed immediately and 
             the return value is assigned to QueryString!
             */
            var query_string = {};
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                // If first entry with this name
                if (typeof query_string[pair[0]] === "undefined") {
                    query_string[pair[0]] = decodeURIComponent(pair[1]);
                    // If second entry with this name
                } else if (typeof query_string[pair[0]] === "string") {
                    var arr = [query_string[pair[0]], decodeURIComponent(pair[1])];
                    query_string[pair[0]] = arr;
                    // If third or later entry with this name
                } else {
                    query_string[pair[0]].push(decodeURIComponent(pair[1]));
                }
            }
            return query_string;
        }();
        // get id from URL
        var userID = QueryString.ID;
//        get info channell
        var ch = QueryString.ch;
        // templating
        var theTemplateScript = $("#news-template").html();
        var theTemplate = Handlebars.compile(theTemplateScript);
        Handlebars.registerHelper('limit', function (arr, limit) {
        // remove this line if you don't want the lodash/underscore dependency
        //  if (!_.isArray(arr)) { return []; }
            return arr.slice(0, limit);
        });
        Handlebars.registerHelper('eachProperty', function(context, options) {
            var ret = "";
            for(var prop in context)
            {
                ret = ret + options.fn({property:prop,value:context[prop]});
            }
            return ret;
        });
        
        function goCompile(returnData){
//            asd = returnData;
            var theCompiledHtml = theTemplate(returnData);
            $('#content-placeholder').html(theCompiledHtml);
            test(0);
        }
        
        function getNews(url) {
            $.ajax({
                type: 'GET',
                url: urlJson,
                crossDomain: true,
                jsonp: false,
                cache: true,
                jsonpCallback: 'jsonCallback',
                dataType: 'jsonp',
                success: function (json) {
                    goCompile(json);
//                    $.each(json.sites, function(a,d){});
                },
                complete: function (){},
                error: function (e) { console.log(e.message); }
            });
        };
        
        var $all = $('.all');
        
        function test(count){
            count = count % $('.all').length;
            $('.all').addClass('collapse');
//            $all.eq(0).toggleClass('hidden');
//            $all.eq(0).fadeIn();
            $('.all').eq(count).delay(1000).slideDown(2000, function(){
                $('.all').delay(6000).fadeOut();
                ++count;
                setTimeout(test(count), 1000);
//                sposta(count);
            });
        }
        
//        var initial = parseInt($('.all').css('left'));
//        var initial = 50;
        function sposta(count){
//            $all.addClass('collapse');
            
            setTimeout(test(count), 2500);
//            $('.placeholder1').css('right', initial-=20);
        }
//        sposta();
        if(!userID && ch){
            var randomN = Math.floor((Math.random() * 1000) + 100);
            window.location.href = 'nuovafarmaciacasarano.html?ch='+ch+'&ID='+ randomN;
            
        } else {
            $('#hubNumber').html(userID);
            urlJson = 'http://www.di-vision.org/getNews.php?userID='+ch+'&content_type=my_news&callback=?';
            returnData = getNews(urlJson);
        }
        
        /*
//                function click(direction) {
//                    $('.'+direction).click(function () {
//                        console.log(direction + "clicked");
//                        animation();
//                    });
//                } */
        (function (exports) {
            var socket = io.connect(socketURI);
//                    generic function for TRIGGER 
//                    function myTrigger(action){
//                        socket.on(userID + '-' + action, function (data) {
//                            console.log("userID: " + userID + " action:" + action + ' | connect!');
//                            $("."+action).trigger('click');
//                        });
//                    }

            socket.on('connection', function (data) {
                console.log('socket connection on');
            });

            socket.on(userID + '-left', function (data) {
                console.log(userID + ' left connect!');
                $(".left").trigger('click');
            });

            socket.on(userID + '-right', function (data) {
                console.log(userID + ' right connect!');
                $(".right").trigger('click');
            });

            socket.on(userID + '-refresh', function (data) {
                console.log('refresh');
            });

            /*
             socket.on(userID + '-refresh2', function (data) {
             console.log('refresh2');
             });
             socket.on(userID+'-OROSCOPO-changeNews', function (data) {
             console.log('change news ch x');
             });
             socket.on(userID+'-SPORT-changeNews', function (data) {
             console.log('change news ch x');
             });
             socket.on(userID+'-HI TECH-changeNews', function (data) {
             console.log('change news ch x');
             });
             socket.on(userID+'-GOSSIP-changeNews', function (data) {
             console.log('change news ch x');
             });
             socket.on(userID+"-ULTIM'ORA-changeNews", function (data) {
             console.log('change news ch x');
             });
             socket.on(userID+"-RPI-changeNews", function (data) {
             console.log('change news ch x');
             });
             socket.on(userID+'-tab0', function (data) {
             $("#panel-0").trigger('click');
             });
             socket.on(userID+'-tab1', function (data) {
             $("#panel-1").trigger('click');
             });
             socket.on(userID+'-tab2', function (data) {
             $("#panel-2").trigger('click');
             });
             socket.on(userID+'-zoomOut', function (data) {
             console.log('zoomOut');
             });
             */
            exports.socket = socket;

        })(window);

        var i = 0;
        var animation = function () {
            i > servizi.length ? i = 0 : ++i;
            $('#servizi').html(servizi[i]).hide().slideDown('slow').delay(5*1000).fadeOut('slow', animation);

            $('#servizi').animate({
                backgroundColor: 'green',
                color: 'red',
            },
            {
                duration: '1500',
                easing: 'swing',
                complete: function(){

                },
                queue: false,
            });
        }
        
        $('#servizi').html(servizi[0]).hide().slideDown('slow').delay(5*1000).fadeOut('slow', animation);

        /*              function jsonCallback(data) {
//                        $.each(data.sites, function (key, val) {
//                            console.log(data);
//                        });
//                    };*/

        $('.right').click(function () {
            console.log('right');
        });
        $('.left').click(function () {
            console.log('left');
            animation();
        });
//        elimina titoli vuoti
        $titles = $('h1');
        $.each($titles, function(){
            this.remove();
        });        
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.js"></script>
        <!--script>
            $('.carousel').carousel({
                interval: 5000,
                keyboard: true,
                ride: true,
                pause: "hover"
            });
            $('#myCarousel').on('slide.bs.carousel', function () {
                // do something…
            });
        </script-->
    </body>
</html>
